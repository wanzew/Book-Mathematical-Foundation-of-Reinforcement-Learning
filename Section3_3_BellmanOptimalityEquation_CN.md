# ------ ç¬¬ 3.2 èŠ‚ Â· Bellman æœ€ä¼˜æ–¹ç¨‹ï¼ˆBellman Optimality Equationï¼‰ ------

> æœ¬èŠ‚ä»æœ€ä¼˜çŠ¶æ€å€¼ä¸åŠ¨ä½œå€¼çš„å®šä¹‰å‡ºå‘ï¼Œæ¨å¯¼å‡ºå¼ºåŒ–å­¦ä¹ ä¸­æœ€æ ¸å¿ƒçš„æ–¹ç¨‹ä¹‹ä¸€ï¼š**Bellman
> æœ€ä¼˜æ–¹ç¨‹**ã€‚ å®ƒæè¿°äº† $v^*$ ä¸ $q^*$ çš„è‡ªæ´½å…³ç³»ï¼Œä¸ºå€¼è¿­ä»£ï¼ˆValue
> Iterationï¼‰ä¸ Q-learning å¥ å®šæ•°å­¦åŸºç¡€ã€‚

------------------------------------------------------------------------

## ğŸ¯ å­¦ä¹ ç›®æ ‡

å­¦ä¹ å®Œæœ¬èŠ‚åï¼Œä½ åº”èƒ½ï¼š\
1. ç†è§£ Bellman æœ€ä¼˜æ–¹ç¨‹çš„æ¨å¯¼è¿‡ç¨‹ä¸æ„ä¹‰ï¼›\
2. åŒºåˆ† Bellman æ–¹ç¨‹ä¸ Bellman **æœ€ä¼˜** æ–¹ç¨‹çš„å·®å¼‚ï¼›\
3. æŒæ¡ $v^*(s)$ ä¸ $q^*(s,a)$ çš„é€’æ¨å½¢å¼ï¼›\
4. èƒ½å°†å…¶è½¬åŒ–ä¸ºå€¼è¿­ä»£ç®—æ³•çš„å·¥ç¨‹å®ç°ã€‚

------------------------------------------------------------------------

## ğŸ“ ä¸€ã€ä»æœ€ä¼˜å®šä¹‰å‡ºå‘

æ ¹æ® (3.1)--(3.4)ï¼Œæˆ‘ä»¬æœ‰ï¼š

$$
v^*(s) = \max_{\pi} v_\pi(s). \tag{3.5}
$$

å°† Bellman æ–¹ç¨‹ (2.5) ä¸­çš„ $v_\pi(s)$ ä»£å…¥ï¼š

$$
v_\pi(s) = \sum_a \pi(a|s)\sum_{s'}p(s'|s,a)\big[r(s,a,s')+\gamma v_\pi(s')\big].
$$

ç”±äºæˆ‘ä»¬å¸Œæœ›å–å¾—æœ€å¤§å€¼ï¼Œå¯¹ç­–ç•¥ $\pi$ å– $\max$ï¼š

$$
v^*(s) = \max_{a}\sum_{s'}p(s'|s,a)\big[r(s,a,s')+\gamma v^*(s')\big]. \tag{3.6}
$$

è¿™å°±æ˜¯ **Bellman æœ€ä¼˜æ–¹ç¨‹çš„çŠ¶æ€å€¼å½¢å¼**ã€‚

> è§£é‡Šï¼šå½“å‰çŠ¶æ€çš„æœ€ä¼˜å€¼ç­‰äºæ‰§è¡Œæœ€ä½³åŠ¨ä½œçš„"å³æ—¶å¥–åŠ± +
> æŠ˜æ‰£åçš„æœ€ä¼˜æœªæ¥å€¼"ã€‚

------------------------------------------------------------------------

## ğŸ’¡ äºŒã€åŠ¨ä½œå€¼å½¢å¼

è‹¥æˆ‘ä»¬è€ƒè™‘åŠ¨ä½œå€¼å‡½æ•°ï¼Œåˆ™ï¼š

$$
q^*(s,a) = \sum_{s'}p(s'|s,a)\big[r(s,a,s')+\gamma\max_{a'}q^*(s',a')\big]. \tag{3.7}
$$

ä¸¤è€…å…³ç³»ï¼š

$$
v^*(s)=\max_a q^*(s,a). \tag{3.8}
$$

> ğŸ“Œ çŠ¶æ€å€¼ $v^*$ ä¸åŠ¨ä½œå€¼ $q^*$ äº’ç›¸é€’æ¨ï¼Œå½¢æˆå¼ºåŒ–å­¦ä¹ çš„æ ¸å¿ƒç»“æ„ã€‚

------------------------------------------------------------------------

## ğŸ§© ä¸‰ã€å›¾åƒåŒ–ç†è§£ï¼ˆFigure 3.2ï¼‰

æƒ³è±¡ä¸€ä¸ªå››æ ¼ä¸–ç•Œï¼ˆGrid Worldï¼‰ï¼š

    [ S1 ] â†’ [ S2 ] â†’ [ S3 ] â†’ [ Goal ]

-   æ¯æ¬¡å³ç§»å¥–åŠ± $r=-1$ï¼›åˆ°è¾¾ Goal å¥–åŠ± $r=+10$ã€‚\
-   æŠ˜æ‰£å› å­ $\gamma = 0.9$ã€‚\
-   æ™ºèƒ½ä½“ä» S1 å‡ºå‘ï¼Œè®¡ç®—æ¯ä¸ªæ ¼å­çš„æœ€ä¼˜ä»·å€¼ï¼š

```{=html}
<!-- -->
```
    S3: v*(S3) = 10
    S2: v*(S2) = -1 + 0.9(10) = 8
    S1: v*(S1) = -1 + 0.9(8) = 6.2

â†’ æœ€ä¼˜ç­–ç•¥ï¼šå§‹ç»ˆå‘å³ã€‚\
Bellman æ–¹ç¨‹æ­£ä½“ç°è¿™ç§"é€æ­¥ä¼˜åŒ–"çš„é€’æ¨æ€§è´¨ã€‚

------------------------------------------------------------------------

## ğŸ”¢ å››ã€æ•°å€¼ä¾‹é¢˜

è€ƒè™‘ä¸€ä¸ª 3 çŠ¶æ€ç³»ç»Ÿï¼š$S=\{A,B,C\}$ã€‚\
è½¬ç§»ä¸å¥–åŠ±å¦‚ä¸‹ï¼š

  çŠ¶æ€   åŠ¨ä½œ   ä¸‹ä¸€çŠ¶æ€   å¥–åŠ±
  ------ ------ ---------- ------
  A      â†’      B          +1
  B      â†’      C          +2
  C      â†’      C          0

æŠ˜æ‰£å› å­ $\gamma=0.9$ã€‚\
ä½¿ç”¨ (3.6)ï¼š

$$
\begin{aligned}
v^*(C) &= 0, \\
v^*(B) &= 2 + 0.9v^*(C) = 2, \\
v^*(A) &= 1 + 0.9v^*(B) = 2.8.
\end{aligned}
$$

â†’ æœ€ä¼˜ç­–ç•¥ä¸ºï¼šAâ†’Bâ†’Cï¼Œä»·å€¼åºåˆ—ä¸º $v^*(A)=2.8,\; v^*(B)=2,\; v^*(C)=0$ã€‚

------------------------------------------------------------------------

## ğŸ§® äº”ã€Pythonä¼ªä»£ç ï¼šå€¼è¿­ä»£ç®—æ³•ï¼ˆValue Iterationï¼‰

``` python
import numpy as np

gamma = 0.9
epsilon = 1e-6
states = ["A", "B", "C"]

# å¥–åŠ±çŸ©é˜µä¸è½¬ç§»çŸ©é˜µ
R = np.array([[0, 1, 0],
              [0, 0, 2],
              [0, 0, 0]])
P = np.array([[[0,1,0],
               [0,0,1],
               [0,0,1]]] * 3)

# åˆå§‹åŒ–
v = np.zeros(3)
for _ in range(1000):
    delta = 0
    v_new = np.zeros(3)
    for s in range(3):
        values = []
        for a in range(3):
            values.append(R[s,a] + gamma * P[s,a].dot(v))
        v_new[s] = max(values)
        delta = max(delta, abs(v_new[s] - v[s]))
    v = v_new
    if delta < epsilon:
        break

print("æœ€ä¼˜çŠ¶æ€å€¼ v* =", v)
```

è¯¥ç®—æ³•å³ä¸º **Bellman æœ€ä¼˜æ–¹ç¨‹çš„è¿­ä»£å®ç°**ï¼Œåœ¨æ¯ä¸€æ­¥æ‰§è¡Œï¼š\
$$
v_{k+1}(s) = \max_a \sum_{s'}p(s'|s,a)[r+\gamma v_k(s')].
$$

å½“ $v_k$ æ”¶æ•›æ—¶ï¼Œå¾—åˆ° $v^*$ã€‚

------------------------------------------------------------------------

## ğŸ§  å…­ã€è‡ªæµ‹é¢˜

1.  è§£é‡Šä¸ºä»€ä¹ˆ Bellman æœ€ä¼˜æ–¹ç¨‹æ˜¯éçº¿æ€§çš„ï¼Œè€Œæ™®é€š Bellman
    æ–¹ç¨‹æ˜¯çº¿æ€§çš„ã€‚\
2.  è‹¥ç¯å¢ƒåªæœ‰ä¸€ä¸ªçŠ¶æ€ä¸” $r=1$ï¼Œ$\gamma=0.9$ï¼Œæ±‚ $v^*$ã€‚\
3.  ä¸ºä»€ä¹ˆ $v^*(s)=\max_a q^*(s,a)$ï¼Ÿæ˜¯å¦æ€»æˆç«‹ï¼Ÿ\
4.  Bellman æœ€ä¼˜æ–¹ç¨‹ä¸åŠ¨æ€è§„åˆ’çš„"æœ€ä¼˜æ€§åŸç†"æœ‰ä½•å…³ç³»ï¼Ÿ

------------------------------------------------------------------------

## ğŸ“˜ ä¸ƒã€ä¸ç¬¬ 3.3 èŠ‚çš„è¡”æ¥

Bellman æœ€ä¼˜æ–¹ç¨‹å®šä¹‰äº†æœ€ä¼˜æ€§çš„é€’æ¨å…³ç³»ï¼Œ
ä½†æˆ‘ä»¬è¿˜éœ€è¯æ˜å®ƒçš„**å”¯ä¸€æ€§ä¸æ”¶æ•›æ€§**ã€‚\
æ¥ä¸‹æ¥çš„ Â§3.3 å°†å¼•å…¥ **æ”¶ç¼©æ˜ å°„å®šç†ï¼ˆContraction Mapping Theoremï¼‰**ï¼Œ
è§£é‡Šä¸ºä»€ä¹ˆé€šè¿‡è¿­ä»£æ±‚è§£ (3.6) ä¸€å®šèƒ½å¾—åˆ°å”¯ä¸€çš„ $v^*$ã€‚
