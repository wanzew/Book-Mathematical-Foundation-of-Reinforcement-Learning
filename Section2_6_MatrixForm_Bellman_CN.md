# 📘 2.6 矩阵形式的 Bellman 方程

本节介绍如何将 Bellman 方程表示为
**矩阵形式**，从而更方便地在多个状态上联合求解。

---

## 🧩 状态值函数的矩阵表示

对于所有状态 $s \in S$，Bellman 方程可写作：

$$
\mathbf{v}_π = \mathbf{r}_π + γP_π\mathbf{v}_π
$$

其中：

- **$\mathbf{v}_π$**：在策略 $π$ 下所有状态的值函数向量\
  $$
  \mathbf{v}_π = [v_π(s_1), v_π(s_2), ..., v_π(s_n)]^T
  $$
- **$\mathbf{r}_π$**：在策略 $π$ 下每个状态的期望即时奖励向量\
  $$
  r_π(s) = \sum_a π(a|s) \sum_r p(r|s,a)r
  $$
- **$P_π$**：状态转移概率矩阵\
  $$
  P_π(s′|s) = \sum_a π(a|s)p(s′|s,a)
  $$

因此，所有状态的 Bellman 方程可以统一写成矩阵形式：

$$
v = r + γPv
$$

---

## 🧮 闭式解（Closed-form Solution）

将上式重写为：

$$
(I - γP)v = r
$$

两边同时左乘 $(I - γP)^{-1}$，得到：

$$
v = (I - γP)^{-1}r
$$

该式给出了 Bellman 方程的**解析解**。它表明：\
\> 状态值函数可以通过求解线性方程组获得。

---

## 📘 可逆性分析（Gershgorin 定理）

矩阵 $(I - γP)$ 总是可逆的。证明思路如下：

- 对任意行 $i$，中心项为：\
  $$
  c = 1 - γp(i|i)
  $$
- 半径为：\
  $$
  R = γ\sum_{j≠i}p(j|i)
  $$ 由于每一行概率和为 $1$ 且 $γ < 1$，有 $R < c$。\
  因此零点不在任意 Gershgorin 圆内，说明 $(I - γP)$ 可逆。
  $$

---

## 📈 性质总结

1.  $(I - γP)^{-1} ≥ I$：矩阵元素非负；\
2.  若 $r ≥ 0$，则 $(I - γP)^{-1}r ≥ r ≥ 0$；\
3.  若 $r_1 ≥ r_2$，则 $v_1 ≥ v_2$，即满足**单调性**。

---

## 💬 小结

矩阵形式的 Bellman 方程为强化学习提供了一个统一的代数表达：

$$
v = r + γPv \Rightarrow v = (I - γP)^{-1}r
$$

它揭示了： - 状态值函数是一组线性方程的解；\

- 折扣因子 $γ$ 保证矩阵可逆、值函数收敛；\
- 矩阵形式为后续的 **动态规划（DP）** 和 **值迭代（Value Iteration）**
  奠定了计算基础。
